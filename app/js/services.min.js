var services=angular.module("Services",["ngResource","ngCookies"]);services.factory("Links",[function(){var aW=globalSeetings.baseUrl;var ac=globalSeetings.path;var aY=aW+ac+"/public/login";var at=aW+ac+"/private/team/all";var ae=aW+ac+"/private/devteam/all";var aO=aW+ac+"/private/super/teamleader/create";var aQ=aW+ac+"/private/super/developer/create";var aT=aW+ac+"/private/super/tester/create";var n=aW+ac+"/private/super/designer/create";var a1=aW+ac+"/private/super/sysadmin/create";var ab=aW+ac+"/private/super/keyaccount/create";var ax=aW+ac+"/private/keyaccount/update";var U=aW+ac+"/private/teamleader/update";var p=aW+ac+"/private/developer/update";var a6=aW+ac+"/private/tester/update";var D=aW+ac+"/private/sysadmin/update";var K=aW+ac+"/private/designer/update";var I=aW+ac+"/private/super/keyaccount/delete";var o=aW+ac+"/private/super/teamleader/delete";var az=aW+ac+"/private/super/developer/delete";var R=aW+ac+"/private/super/tester/delete";var d=aW+ac+"/private/super/sysadmin/delete";var q=aW+ac+"/private/super/designer/delete";var V=aW+ac+"/private/team/upload/photo";var a=aW+ac+"/private/super/keyaccount/all";var w=aW+ac+"/private/keyaccount/customer/create";var aL=aW+ac+"/private/keyaccount/customer/all";var aU=aW+ac+"/private/customer/update";var aS=aW+ac+"/private/keyaccount/customer/delete";var ar=aW+ac+"/private/customer/users/create";var aA=aW+ac+"/private/customer/users/update";var af=aW+ac+"/private/customer/users/all";var H=aW+ac+"/private/customer/users/delete";var aV=aW+ac+"/private/customer/users/upload/photo";var aE=aW+ac+"/private/chat/info";var aH=aW+ac+"/private/chat/messages";var T=aW+ac+"/private/chat/new";var aq=aW+ac+"/private/chat/mark";var X=aW+ac+"/private/chat/newmessages/number";var ao=aW+ac+"/private/chat/send";var L=aW+ac+"/private/project/restricted/create";var aJ=aW+ac+"/private/project/list";var s=aW+ac+"/private/project/details";var am=aW+ac+"/private/token/expired";var z=aW+ac+"/private/project/teamleader/assign";var W=aW+ac+"/private/teamleader/project/developer/add";var G=aW+ac+"/private/teamleader/project/designer/add";var aI=aW+ac+"/private/teamleader/project/tester/add";var v=aW+ac+"/private/teamleader/project/sysadmin/add";var a3=aW+ac+"/private/teamleader/project/developer/delete";var aM=aW+ac+"/private/teamleader/project/tester/delete";var ad=aW+ac+"/private/teamleader/project/designer/delete";var a5=aW+ac+"/private/teamleader/project/sysadmin/delete";var m=aW+ac+"/private/roles";var r=aW+ac+"/private/project/restricted/budget";var k=aW+ac+"/private/project/configs/list";var al=aW+ac+"/private/project/restricted/config/delete";var aN=aW+ac+"/private/project/restricted/config/create";var ak=aW+ac+"/private/project/restricted/config/update";var av=aW+ac+"/private/ticket/types";var ah=aW+ac+"/private/project/restricted/ticket/create";var ai=aW+ac+"/private/ticket/list";var h=aW+ac+"/private/project/restricted/ticket/startestipamtion";var P=aW+ac+"/private/project/restricted/ticket/acceptestipamtion";var a0=aW+ac+"/private/project/restricted/ticket/rejectestipamtion";var A=aW+ac+"/private/project/restricted/ticket/accept";var e=aW+ac+"/private/project/restricted/ticket/reject";var g=aW+ac+"/private/project/restricted/ticket/delete";var ay=aW+ac+"/private/project/restricted/ticket/update";var aw=aW+ac+"/private/project/task/create";var Q=aW+ac+"/private/project/task/update";var M=aW+ac+"/private/project/task/list";var u=aW+ac+"/private/project/task/estimation";var y=aW+ac+"/private/project/task/delete";var N=aW+ac+"/private/project/ticket/sent";var au=aW+ac+"/private/project/ticket/production";var C=aW+ac+"/private/project/task/start";var aj=aW+ac+"/private/project/task/finish";var aC=aW+ac+"/private/project/task/realtime";var b=aW+ac+"/private/project/ticket/acceptance";var x=aW+ac+"/private/project/restricted/ticket/file/uplaod";var a4=aW+ac+"/private/project/file/list";var aP=aW+ac+"/private/customer/contract/accept";var aD=aW+ac+"/private/project/restricted/accept";var l=aW+ac+"/private/management/project/client/list";var aB=aW+ac+"/private/super/project/rate";var aX=aW+ac+"/private/project/restricted/update";var F=aW+ac+"/private/project/task/realtime/create";var ag=aW+ac+"/private/project/task/realtime/update";var S=aW+ac+"/private/project/task/realtime/delete";var aF=aW+ac+"/private/project/task/realtime/all";var t=aW+ac+"/private/team/performance";var aR=aW+ac+"/private/project/restricted/report/ticket";var c=aW+ac+"/private/project/restricted/report/date";var aa=aW+ac+"/private/password/change";var aK=aW+ac+"/private/management/project/ticket/billed";var B=aW+ac+"/private/management/project/ticket/payed";var Z=aW+ac+"/private/management/project/ticket/manybilled";var aZ=aW+ac+"/private/logout";var O=aW+ac+"/private/management/project/contract";var J=aW+ac+"/private/task/types";var E=aW+ac+"/private/task/accept";var Y=aW+ac+"/private/project/file/delete";var a2=aW+ac+"/private/ticket/bug/deliver/";var an=aW+ac+"/private/project/estimation";var ap=aW+ac+"/private/super/dashboard";var aG=aW+ac+"/private/project/emailnotif/disable/";var f=aW+ac+"/private/client/desactivate/";this.getLoginLink=function(){return aY};this.getChangePasswordLink=function(){return aa};this.getAllteamMembersLink=function(){return at};this.getcreateTeamLeaderLink=function(){return aO};this.getCreatedeveloperLink=function(){return aQ};this.getCreatetesterLink=function(){return aT};this.getCreatedesignerLink=function(){return n};this.getCreatesysadminLink=function(){return a1};this.getCreatekeyaccountLink=function(){return ab};this.getUpdateTeamLeaderLink=function(){return U};this.getUpdatedeveloperLink=function(){return p};this.getUpdatetesterLink=function(){return a6};this.getUpdatedesignerLink=function(){return K};this.getUpdatesysadminLink=function(){return D};this.getUpdatekeyaccountLink=function(){return ax};this.getDeleteTeamLeaderLink=function(){return o};this.getDeletedeveloperLink=function(){return az};this.getDeletetesterLink=function(){return R};this.getDeletedesignerLink=function(){return q};this.getDeletesysadminLink=function(){return d};this.getDeletekeyaccountLink=function(){return I};this.getImageUplaodLink=function(){return V};this.getAccountManagersListLink=function(){return a};this.getCreateClientLink=function(){return w};this.getListCustomersLink=function(){return aL};this.getUpdateCustomerLink=function(){return aU};this.getDeleteClientLink=function(){return aS};this.getCreateCuserLink=function(){return ar};this.getUpdateCuserLink=function(){return aA};this.getListCuserLink=function(){return af};this.getdeleteCuserLink=function(){return H};this.getCuserUploadPhotoLink=function(){return aV};this.getChannelInfoLink=function(){return aE};this.getMessagesLink=function(){return aH};this.getNewMessagesLink=function(){return T};this.getMakreadmessagesLink=function(){return aq};this.getNewMessageNumberLink=function(){return X};this.getSendMessageLink=function(){return ao};this.getCreateProjectLink=function(){return L};this.getListProjectLink=function(){return aJ};this.getProjectDetailLink=function(){return s};this.getIsExpiredLink=function(){return am};this.getAllDevTeamMemberLink=function(){return ae};this.getAssignTealLeaderLink=function(){return z};this.getAddDeveloperLink=function(){return W};this.getAddDesignerLink=function(){return G};this.getAddTesterLink=function(){return aI};this.getAddSysAdminLink=function(){return v};this.getDeleteDeveloperFromProjectLink=function(){return a3};this.getDeleteTesterFromProjectLink=function(){return aM};this.getDeleteDesignerFromProjectLink=function(){return ad};this.getDeleteSysAdminFromProjectLink=function(){return a5};this.getGetRolesLink=function(){return m};this.getAssignBudgetLink=function(){return r};this.getProjectConfigsListLink=function(){return k};this.getDeleteProjectConfigLink=function(){return al};this.getCreateProjectConfigLink=function(){return aN};this.getUpdateProjectConfigLink=function(){return ak};this.getTicketTypesLink=function(){return av};this.getCreateTicketLink=function(){return ah};this.getTicketListLink=function(){return ai};this.getStartEstimationLink=function(){return h};this.getAcceptEstimationLink=function(){return P};this.getRejectEstimationLink=function(){return a0};this.getAcceptTicketLink=function(){return A};this.getRejectionTicketLink=function(){return e};this.getDeleteTicketLink=function(){return g};this.getUpdateTicketLink=function(){return ay};this.getCreatetaskLink=function(){return aw};this.getUpdatetaskLink=function(){return Q};this.getListTasksLink=function(){return M};this.getEstimationLink=function(){return u};this.getDeleteTaskLink=function(){return y};this.GetSendToClientLink=function(){return N};this.GetSendToProdLink=function(){return au};this.getStartTaskLink=function(){return C};this.getFinishTaskLink=function(){return aj};this.getRealtimeLink=function(){return aC};this.GetdeliverToClientLink=function(){return b};this.getUplaodfileLink=function(){return x};this.getDocumentslistLink=function(){return a4};this.getAcceptContractLink=function(){return aP};this.getAcceptProjectContractLink=function(){return aD};this.getListProjectByClientLink=function(){return l};this.getAssignRateLink=function(){return aB};this.getUpdateProjectLink=function(){return aX};this.getAddRealtimeLink=function(){return F};this.getUpdateRealtimeLink=function(){return ag};this.getDeleteRealtimeLink=function(){return S};this.getAllRealtimesLink=function(){return aF};this.getTeamPerformanceLink=function(){return t};this.getTicketReportByMonthLink=function(){return aR};this.getDateReportByMonthLink=function(){return c};this.getMarkBilledLink=function(){return aK};this.getMarkPayedLink=function(){return B};this.getMarkmanyBilledLink=function(){return Z};this.getLogoutLink=function(){return aZ};this.getPrepareContractLink=function(){return O};this.getTaskTypesLink=function(){return J};this.getAcceptBugLink=function(){return E};this.getDeleteFileLink=function(){return Y};this.getDeliverBugToClientLink=function(){return a2};this.getassignEstimationProjectLink=function(){return an};this.getAdminDashboardLink=function(){return ap};this.getDisableEmailNotifLink=function(){return aG};this.getDesactivateClientLink=function(){return f};return this}]);services.factory("Login",["$http","$location","$cookies","$route","Links",function(h,e,d,k,f){var a=null;var l=["","/login","/dashboard","/client","/teamprofile","/team","/messaging","/pdetails","/keybox","/stories","/clientprojects","/report"];var m=["","/login","/dashboard","/cuser","/cuserprofile","/messaging","/pdetails","/keybox","/stories","/acceptcontract","/report","/invoice"];var c=["","/login","/dashboard","/pdetails","/client","/keybox","/stories","/clientprojects","/report"];var b=["","/login","/dashboard","/pdetails","/keybox","/stories"];var g=["","/login","/dashboard","/pdetails","/keybox","/stories"];this.setLastLink=function(n){this.lastlink=n};this.changePassword=function(o,p,n){if(this.getLoggedUser()){h({method:"PUT",url:f.getChangePasswordLink(),data:o,headers:{"x-crm-access-token":this.getLoggedUser().token.token}}).success(function(s,q,t,r){p()}).error(function(s,q,t,r){if(q==403){n("wrong password")}else{n("Something bad happen please try again later")}})}};this.contractSigned=function(){if(this.getLoggedUser()){var n=this.getLoggedUser().userinfo.roles[0];if(n=="ROLE_CUSTOMER"){if(!this.getLoggedUser().userinfo.signed){e.url("/acceptcontract/"+this.getLoggedUser().userinfo.id)}}}};this.signContract=function(q,n,r){var p=this;var o=this.getLoggedUser();if(o){h({method:"GET",url:f.getAcceptContractLink()+"/"+r,headers:{"x-crm-access-token":this.getLoggedUser().token.token}}).success(function(u,s,v,t){o.userinfo.signed=true;p.upadteLoggedinUser(o);q()}).error(function(u,s,v,t){if(s==403){p.logout()}else{n()}})}};this.upadteLoggedinUser=function(n){d.remove("loggeduser");d.put("loggeduser",JSON.stringify(n))};this.doLogin=function(o,p,r,n,q){postdata={grant_type:"password",password:p,login:o,stayloggedin:r};h({method:"POST",url:f.getLoginLink(),data:postdata,headers:{"Content-Type":"application/json"}}).success(function(w,s,x,u){var t={};w.token.experationDate.date=w.token.experationDate.date.replace(".000000","");w.token.experationDate.date=w.token.experationDate.date.replace(" ","T");t.userinfo=w.user;t.token=w.token;var v=new Date();v.setMonth(v.getMonth()+12);d.put("loggeduser",JSON.stringify(t),{expires:v});n()}).error(function(u,s,v,t){if(s==403){q(u.errors)}else{q("Please try again later")}})};this.getLoggedUser=function(){if(d.get("loggeduser")!=undefined){var n=JSON.parse(d.get("loggeduser"));if(n!=null){return n}else{return false}}else{return false}};this.logout=function(n){h({method:"GET",url:f.getLogoutLink(),headers:{"x-crm-access-token":this.getLoggedUser().token.token}}).success(function(r,p,s,q){}).error(function(r,p,s,q){});d.remove("loggeduser");window.Intercom("shutdown");n=false;if(n){var o=e.path();e.url("/login?last="+o)}else{e.url("/login")}};this.haveAccess=function(n){if(n==undefined){n=e.path()}if(this.getLoggedUser()){var o=this.getLoggedUser().userinfo.roles[0]}else{return false}if(o=="ROLE_ADMIN"){if(this.checkStrings(l,n)){return true}else{return false}}else{if(o=="ROLE_CUSTOMER"||o=="ROLE_CUSER"){if(this.checkStrings(m,n)){return true}else{return false}}else{if(o=="ROLE_TEAMLEADER"){if(this.checkStrings(b,n)){return true}else{return false}}else{if(o=="ROLE_KEYACCOUNT"){if(this.checkStrings(c,n)){return true}else{return false}}else{if(o=="ROLE_DEVELOPER"||o=="ROLE_DESIGNER"||o=="ROLE_TESTER"||o=="ROLE_SYSADMIN"){if(this.checkStrings(g,n)){return true}else{return false}}}}}}};this.checkStrings=function(o,n){if(n==""){return true}for(i=0;i<o.length;i++){if(o[i]!=""&&n.startsWith(o[i])){return true}}return false};this.isTokenExpired=function(p){var o=this.getLoggedUser();var n=this;if(o){h({method:"GET",url:f.getIsExpiredLink(),headers:{"x-crm-access-token":this.getLoggedUser().token.token}}).success(function(s,q,t,r){p()}).error(function(s,q,t,r){n.logout()})}else{e.url("/login")}};this.toUTCdate=function(o,n){return o.getTime()-(n*60000)};return this}]);services.factory("Team",["$http","$location","$cookieStore","Login","Links",function(e,d,c,b,a){this.roles=null;this.loadRoles=function(f){if(localStorage.roles!=null){f(JSON.parse(localStorage.roles));this.roles=JSON.parse(localStorage.roles)}else{me=this;if(b.getLoggedUser()&&this.roles==null){e({method:"GET",url:a.getGetRolesLink(),headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){localStorage.roles=JSON.stringify(k.Roles);f(k.Roles);me.roles=k.Roles}).error(function(k,g,l,h){if(g==403){b.logout()}})}}};this.getRoles=function(){return JSON.parse(localStorage.roles)};this.getAllteamMembers=function(f,g){if(b.getLoggedUser()){e({method:"GET",url:a.getAllteamMembersLink(),headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){for(i=0;i<l.length;i++){if(l[i].photo==null){l[i].photo="img/users/profile_default_small.jpg"}}f(l)}).error(function(l,h,m,k){if(h==403){b.logout()}})}};this.getAlldevteamMembers=function(f,g){if(b.getLoggedUser()){e({method:"GET",url:a.getAllDevTeamMemberLink(),headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){for(i=0;i<l.length;i++){if(l[i].photo==null){l[i].photo="img/users/profile_default_small.jpg";l[i].bigphoto="img/users/profile_default_small.jpg"}}f(l)}).error(function(l,h,m,k){if(h==403){b.logout()}else{g()}})}};this.getTeamPerformanceByMonth=function(f,g,h){if(b.getLoggedUser()){e({method:"GET",url:a.getTeamPerformanceLink()+"/"+h,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(m,k,n,l){f(m)}).error(function(m,k,n,l){if(k==403){b.logout()}})}};this.createTeamLeader=function(h,g,f){this.addTeamMember(a.getcreateTeamLeaderLink(),h,g,f,"POST")};this.createDeveloper=function(h,g,f){this.addTeamMember(a.getCreatedeveloperLink(),h,g,f,"POST")};this.createTester=function(h,g,f){this.addTeamMember(a.getCreatetesterLink(),h,g,f,"POST")};this.createDesigner=function(h,g,f){this.addTeamMember(a.getCreatedesignerLink(),h,g,f,"POST")};this.createSysAdmin=function(h,g,f){this.addTeamMember(a.getCreatesysadminLink(),h,g,f,"POST")};this.createKeyAccount=function(h,g,f){this.addTeamMember(a.getCreatekeyaccountLink(),h,g,f,"POST")};this.updateTeamLeader=function(h,g,f){this.addTeamMember(a.getUpdateTeamLeaderLink(),h,g,f,"PUT")};this.updateDeveloper=function(h,g,f){this.addTeamMember(a.getUpdatedeveloperLink(),h,g,f,"PUT")};this.updateTester=function(h,g,f){this.addTeamMember(a.getUpdatetesterLink(),h,g,f,"PUT")};this.updateDesigner=function(h,g,f){this.addTeamMember(a.getUpdatedesignerLink(),h,g,f,"PUT")};this.updateSysAdmin=function(h,g,f){this.addTeamMember(a.getUpdatesysadminLink(),h,g,f,"PUT")};this.updateKeyAccount=function(h,g,f){this.addTeamMember(a.getUpdatekeyaccountLink(),h,g,f,"PUT")};this.deleteTeamLeader=function(h,g,f){this.deleteTeamMember(a.getDeleteTeamLeaderLink(),h,g,f)};this.deleteDeveloper=function(h,g,f){this.deleteTeamMember(a.getDeletedeveloperLink(),h,g,f)};this.deleteTester=function(h,g,f){this.deleteTeamMember(a.getDeletetesterLink(),h,g,f)};this.deleteDesigner=function(h,g,f){this.deleteTeamMember(a.getDeletedesignerLink(),h,g,f)};this.deleteSysAdmin=function(h,g,f){this.deleteTeamMember(a.getDeletesysadminLink(),h,g,f)};this.deleteKeyAccount=function(h,g,f){this.deleteTeamMember(a.getDeletekeyaccountLink(),h,g,f)};this.addTeamMember=function(g,l,h,f,k){if(b.getLoggedUser()){e({method:k,url:g,data:l,headers:{"Content-Type":"application/json","x-crm-access-token":b.getLoggedUser().token.token}}).success(function(o,m,p,n){h()}).error(function(o,m,p,n){if(m==403){b.logout()}else{f(o.errors)}})}};this.deleteTeamMember=function(g,k,h,f){if(b.getLoggedUser()){e({method:"delete",url:g+"/"+k.id,headers:{"Content-Type":"application/json","x-crm-access-token":b.getLoggedUser().token.token}}).success(function(n,l,o,m){h()}).error(function(n,l,o,m){if(l==403){b.logout()}else{f(n.errors)}})}};this.uploadMemberImage=function(l,k,h,g,f){if(b.getLoggedUser()){e({method:"post",url:a.getImageUplaodLink()+"/"+l+"/"+k,data:h,headers:{"Content-Type":"application/json","x-crm-access-token":b.getLoggedUser().token.token}}).success(function(o,m,p,n){g()}).error(function(o,m,p,n){if(m==403){b.logout()}else{f(o.errors)}})}};return this}]);services.factory("Client",["$http","Login","Links",function(c,b,a){this.desactivateClient=function(g,d,f,e){if(b.getLoggedUser()){c({method:"GET",url:a.getDesactivateClientLink()+f+"/"+e,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){g()}).error(function(l,h,m,k){if(h==403){b.logout()}else{d()}})}};this.getAllKeyAccounts=function(f,d,e){if(b.getLoggedUser()){c({method:"GET",url:a.getAccountManagersListLink()+"/"+e,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){f(k.users)}).error(function(k,g,l,h){if(g==403){b.logout()}else{d()}})}};this.addClient=function(e,g,d,h){if(b.getLoggedUser()){if(h=="POST"){var f=a.getCreateClientLink()}else{var f=a.getUpdateCustomerLink()}c({method:h,url:f,data:e,headers:{"Content-Type":"application/json","x-crm-access-token":b.getLoggedUser().token.token}}).success(function(m,k,n,l){if(h=="POST"){g("Client added successfully")}else{g("Client updated successfully")}}).error(function(m,k,n,l){if(k==403){b.logout()}else{d(m.errors)}})}};this.getAllClients=function(f,d,e){if(b.getLoggedUser()){c({method:"GET",url:a.getListCustomersLink()+"/"+e,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){f(k.users,k.totalpages,k.current_page)}).error(function(k,g,l,h){if(g==403){b.logout()}})}};this.deleteClient=function(e,f,d){if(b.getLoggedUser()){c({method:"delete",url:a.getDeleteClientLink()+"/"+e.id,headers:{"Content-Type":"application/json","x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){f()}).error(function(k,g,l,h){if(g==403){b.logout()}else{d(k.errors)}})}};return this}]);services.factory("Cuser",["$http","Login","Links",function(c,b,a){this.addUser=function(e,g,d,h){if(b.getLoggedUser()){if(h=="POST"){var f=a.getCreateCuserLink()}else{var f=a.getUpdateCuserLink()}c({method:h,url:f,data:e,headers:{"Content-Type":"application/json","x-crm-access-token":b.getLoggedUser().token.token}}).success(function(m,k,n,l){if(h=="POST"){g("User added successfully")}else{g("User updated successfully")}}).error(function(m,k,n,l){if(k==403){b.logout()}else{d(m.errors)}})}};this.getAllUsers=function(f,d,e){if(b.getLoggedUser()){c({method:"GET",url:a.getListCuserLink()+"/"+e,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){for(i=0;i<k.users.length;i++){if(k.users[i].photo==null){k.users[i].photo="img/users/profile_default_small.jpg";k.users[i].bigphoto="img/users/profile_default_small.jpg"}}f(k.users)}).error(function(k,g,l,h){if(g==403){b.logout()}})}};this.deleteUser=function(e,f,d){if(b.getLoggedUser()){c({method:"delete",url:a.getdeleteCuserLink()+"/"+e.id,headers:{"Content-Type":"application/json","x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){f()}).error(function(k,g,l,h){if(g==403){b.logout()}else{d(k.errors)}})}};this.uploadCuserImage=function(g,f,e,d){if(b.getLoggedUser()){c({method:"post",url:a.getCuserUploadPhotoLink()+"/"+g,data:f,headers:{"Content-Type":"application/json","x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){e()}).error(function(l,h,m,k){if(h==403){b.logout()}else{d(l.errors)}})}};return this}]);services.factory("Params",["$http",function(f){var e=null;var a=null;var d=null;var c=null;var b=null;if(sessionStorage.skills!=null){b=JSON.parse(sessionStorage.skills)}return{skills:b,setTeamMember:function(g){e=g},getTeamMember:function(){return e},setCuser:function(g){a=g},getCuser:function(){return a},setProject:function(g){localStorage.project=JSON.stringify(g);d=g},getProject:function(){if(d==null){d=JSON.parse(localStorage.project)}return d},setTicket:function(g){localStorage.ticket=JSON.stringify(g);c=g},getTicket:function(){if(c==null){c=JSON.parse(localStorage.ticket)}return c},getSkills:function(h){var g=this;if(this.skills==null){f({method:"get",url:"locals/skills.txt",}).success(function(m,k,n,l){var o=m.split("\n");h(o);g.skills=o;sessionStorage.skills=JSON.stringify(o)}).error(function(m,k,n,l){console.log(m)})}else{h(this.skills)}}}}]);services.factory("Chat",["$http","Login","Links",function(c,b,a){this.team=null;this.first=null;this.has_more=false;this.newmessagesCount=0;this.getChannelInfo=function(e,g,h,d,k){if(b.getLoggedUser()){var f=this;c({method:"GET",url:a.getChannelInfoLink()+"/"+e,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(n,l,o,m){f.team=n.members;g(n);f.getMessages(e,h,d,k)}).error(function(n,l,o,m){if(l==403){b.logout()}else{d(n.error)}})}};this.formatSlackMessages=function(f){var e=new Array();this.first=f.messages[f.messages.length-1];for(i=0;i<f.messages.length;i++){var g=this.formatOneSlackMessage(f.messages[i]);if(g.mustdelete){e.push(f.messages[i])}else{f.messages[i]=g.message}}for(i=0;i<e.length;i++){var d=f.messages.indexOf(e[i]);f.messages.splice(d,1)}f.messages.reverse();return f};this.formatOneSlackMessage=function(g){var f=false;var k=g.ts.split(".")[0];var l=new Date(new Number(k)*1000);g.hour=l.getHours();g.minutes=l.getMinutes();g.day=l.getDate();g.month=l.getMonth()+1;g.year=l.getFullYear();g.date=l;for(j=0;j<this.team.length;j++){if(g.user!=undefined){if(g.user==this.team[j].id){g.username=this.team[j].name;g.userphoto=this.team[j].profile.image_32}}else{g.userphoto="img/users/profile_default_small.jpg"}if(g.text!=undefined){if(g.text.indexOf("<http")>-1){var e="";var d=g.text.indexOf("<http")+1;while(g.text.charAt(d)!=">"){e+=g.text[d];d++}g.text=g.text.replace("<"+e+">",'<a href="'+e+'">'+e+"</a>")}if(g.text.indexOf("<@"+this.team[j].id+">")>-1){g.text=g.text.replace("<@"+this.team[j].id+">","@"+this.team[j].name)}if(g.text.indexOf("<@"+this.team[j].id+"|"+this.team[j].name+">")>-1){g.text=g.text.replace("<@"+this.team[j].id+"|"+this.team[j].name+">","@<a>"+this.team[j].name+"</a>")}}else{f=true}}return{message:g,mustdelete:f}};this.getMessages=function(e,g,d,h){if(h!=0){if(this.first===undefined){return}else{h=this.first.ts}}if(b.getLoggedUser()){var f=this;c({method:"GET",url:a.getMessagesLink()+"/40/"+e+"/"+h,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(m,k,n,l){if(m.messages.length>0){m=f.formatSlackMessages(m)}f.has_more=m.hasmore;g(m)}).error(function(m,k,n,l){if(k==403){b.logout()}else{d(m.error)}})}};this.isHasMore=function(){return this.has_more};this.getNewMessages=function(e,h,d,g){if(b.getLoggedUser()){var f=this;c({method:"GET",url:a.getNewMessagesLink()+"/"+e+"/"+g,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(m,k,n,l){m=f.formatSlackMessages(m);h(m)}).error(function(m,k,n,l){if(k==403){b.logout()}else{d(m.error)}})}};this.markreadMessages=function(d,f){if(b.getLoggedUser()){var e=this;c({method:"GET",url:a.getMakreadmessagesLink()+"/"+d+"/"+f,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){}).error(function(k,g,l,h){if(g==403){b.logout()}})}};this.getNewMessagesNumber=function(f,d){if(b.getLoggedUser()){var e=this;c({method:"POST",url:a.getNewMessageNumberLink(),headers:{"x-crm-access-token":b.getLoggedUser().token.token},data:f}).success(function(k,g,l,h){d(k)}).error(function(k,g,l,h){if(g==403){b.logout()}})}};this.sendMessage=function(g,h,f){var e=this;if(b.getLoggedUser()){var k=b.getLoggedUser().userinfo.name;var d={message:h,client:k};c({method:"POST",data:d,url:a.getSendMessageLink()+"/"+g,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(n,l,o,m){n.message.userphoto="img/users/profile_default_small.jpg";n.message=e.formatOneSlackMessage(n.message);f(n)}).error(function(n,l,o,m){if(l==403){b.logout()}})}};return this}]);services.factory("Project",["$http","Login","Links",function(c,b,a){this.acceptContract=function(f,d,e){if(b.getLoggedUser()){c({method:"GET",url:a.getAcceptProjectContractLink()+"/"+e,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){f()}).error(function(k,g,l,h){if(g==403){b.logout()}else{d()}})}};this.assignProjectEstimation=function(f,d,e){c({method:"POST",data:e,url:a.getassignEstimationProjectLink(),headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){f()}).error(function(k,g,l,h){if(g==403){b.logout()}else{d()}})};this.getTicketReportbyMonth=function(g,d,h,f,e){if(b.getLoggedUser()){c({method:"GET",url:a.getTicketReportByMonthLink()+"/"+h+"/"+f+"/"+e,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(m,k,n,l){g(m)}).error(function(m,k,n,l){if(k==403){b.logout()}else{d()}})}};this.getDateReportbyMonth=function(g,d,h,f,e){if(b.getLoggedUser()){c({method:"GET",url:a.getDateReportByMonthLink()+"/"+h+"/"+f+"/"+e,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(m,k,n,l){g(m)}).error(function(m,k,n,l){if(k==403){b.logout()}else{d()}})}};this.createProject=function(e,f,d){c({method:"POST",data:e,url:a.getCreateProjectLink(),headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){f(k)}).error(function(k,g,l,h){if(g==403){b.logout()}else{d()}})};this.updateProject=function(e,f,d){c({method:"PUT",data:e,url:a.getUpdateProjectLink(),headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){f()}).error(function(k,g,l,h){if(g==403){b.logout()}else{d()}})};this.getAllproject=function(d){c({method:"GET",url:a.getListProjectLink()+"/1/all",headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(g,e,h,f){d(g)}).error(function(g,e,h,f){if(e==403){b.logout()}})};this.getProjectDetails=function(e,f,d){c({method:"GET",url:a.getProjectDetailLink()+"/"+e,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){f(k)}).error(function(k,g,l,h){if(g==403){b.logout()}else{d("error")}})};this.assignTeamLeader=function(f,d,e){this.ProjectMember(a.getAssignTealLeaderLink(),e,f,d)};this.addDeveloper=function(f,d,e){this.ProjectMember(a.getAddDeveloperLink(),e,f,d)};this.addDesigner=function(f,d,e){this.ProjectMember(a.getAddDesignerLink(),e,f,d)};this.addTester=function(f,d,e){this.ProjectMember(a.getAddTesterLink(),e,f,d)};this.addSystemAdmin=function(f,d,e){this.ProjectMember(a.getAddSysAdminLink(),e,f,d)};this.deleteDeveloperFromProject=function(f,d,e){this.ProjectMember(a.getDeleteDeveloperFromProjectLink(),e,f,d)};this.deleteTesterFromProject=function(f,d,e){this.ProjectMember(a.getDeleteTesterFromProjectLink(),e,f,d)};this.deleteDesignerFromProject=function(f,d,e){this.ProjectMember(a.getDeleteDesignerFromProjectLink(),e,f,d)};this.deleteSysAdminFromProject=function(f,d,e){this.ProjectMember(a.getDeleteSysAdminFromProjectLink(),e,f,d)};this.ProjectMember=function(e,g,f,d){c({method:"POST",url:e,data:g,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){f(l)}).error(function(l,h,m,k){if(h==403){b.logout()}else{d("error")}})};this.assignProjectBudget=function(f,d,e){if(b.getLoggedUser()){c({method:"POST",url:a.getAssignBudgetLink(),data:e,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){f(k)}).error(function(k,g,l,h){if(g==403){b.logout()}else{d("error")}})}};this.assignProjectRate=function(f,d,e){if(b.getLoggedUser()){c({method:"POST",url:a.getAssignRateLink(),data:e,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){f()}).error(function(k,g,l,h){if(g==403){b.logout()}else{d("error")}})}};this.projectsbyclient=function(e,d,f){if(b.getLoggedUser()){c({method:"GET",url:a.getListProjectByClientLink()+"/"+f,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){successFunc(k)}).error(function(k,g,l,h){if(g==403){b.logout()}else{d()}})}};this.disableEmailNotif=function(e,d,g,f){if(b.getLoggedUser()){c({method:"GET",url:a.getDisableEmailNotifLink()+g+"/"+f,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){e(l)}).error(function(l,h,m,k){if(h==403){b.logout()}else{d()}})}};this.prepareContract=function(f,d,e){if(b.getLoggedUser()){c({method:"POST",url:a.getPrepareContractLink(),data:e,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){f()}).error(function(k,g,l,h){if(g==403){b.logout()}else{d("error")}})}};return this}]);services.factory("KeyBox",["$http","Login","Links",function(c,b,a){this.getProjectConfigs=function(e,g,d){if(b.getLoggedUser()){var f=this;c({method:"GET",url:a.getProjectConfigsListLink()+"/"+e,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){g(l)}).error(function(l,h,m,k){if(h==403){b.logout()}else{d(l.error)}})}};this.deleteProjectConfig=function(f,d,g){if(b.getLoggedUser()){var e=this;c({method:"DELETE",url:a.getDeleteProjectConfigLink()+"/"+g,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){f(l)}).error(function(l,h,m,k){if(h==403){b.logout()}else{d(l.error)}})}};this.createProjectConfig=function(g,d,f){if(b.getLoggedUser()){var e=this;c({method:"POST",url:a.getCreateProjectConfigLink(),data:f,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){g(l)}).error(function(l,h,m,k){if(h==403){b.logout()}else{d(l.error)}})}};this.updateProjectConfig=function(g,d,f){if(b.getLoggedUser()){var e=this;c({method:"PUT",url:a.getUpdateProjectConfigLink(),data:f,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){g(l)}).error(function(l,h,m,k){if(h==403){b.logout()}else{d(l.error)}})}};return this}]);services.service("Ticket",["$http","Login","Links",function(d,c,b){this.ticketypes=null;this.ticketstatus={All:{status:"all",text:"All status"},Draft:{status:"draft",text:"Draft"},Estimation:{status:"estimation",text:"Estimation"},Goproduction:{status:"goproduction",text:"Go production"},Waiting:{status:"waiting",text:"Waiting"},Production:{status:"production",text:"Production"},Testing:{status:"testing",text:"Testing"},Accept:{status:"accept",text:"Accept"},Reject:{status:"reject",text:"Reject"},Done:{status:"done",text:"Done"},toArray:function(){return[this.All,this.Draft,this.Estimation,this.Goproduction,this.Waiting,this.Production,this.Accept,this.Reject,this.Done]}};var a=this;this.loadTicketTypes=function(e){if(c.getLoggedUser()){if(localStorage.tickettypes==null){d({method:"GET",url:b.getTicketTypesLink(),headers:{"x-crm-access-token":c.getLoggedUser().token.token}}).success(function(h,f,k,g){localStorage.ticketypes=JSON.stringify(h);e(h)}).error(function(h,f,k,g){if(f==403){c.logout()}})}else{e(JSON.parse(localStorage.ticketypes))}}};this.getTicketTypes=function(){return JSON.parse(localStorage.ticketypes)};this.createTicket=function(g,e,f){if(c.getLoggedUser()){d({method:"POST",data:f,url:b.getCreateTicketLink(),headers:{"x-crm-access-token":c.getLoggedUser().token.token}}).success(function(l,h,m,k){g()}).error(function(l,h,m,k){if(h==403){c.logout()}else{e()}})}};this.getTicketList=function(g,e,f){if(c.getLoggedUser()){d({method:"GET",url:b.getTicketListLink()+"/"+f,headers:{"x-crm-access-token":c.getLoggedUser().token.token}}).success(function(l,h,m,k){g(l)}).error(function(l,h,m,k){if(h==403){c.logout()}else{e()}})}};this.sendToClient=function(f,e,g){this.changeTicketStatus(f,e,g,b.GetSendToClientLink())};this.sendToProd=function(f,e,g){this.changeTicketStatus(f,e,g,b.GetSendToProdLink())};this.deliverToClient=function(f,e,g){this.changeTicketStatus(f,e,g,b.GetdeliverToClientLink())};this.startEstimation=function(f,e,g){this.changeTicketStatus(f,e,g,b.getStartEstimationLink())};this.acceptEstimation=function(f,e,g){this.changeTicketStatus(f,e,g,b.getAcceptEstimationLink())};this.rejectEstimation=function(f,e,g){this.changeTicketStatus(f,e,g,b.getRejectEstimationLink())};this.acceptTicket=function(f,e,g){this.changeTicketStatus(f,e,g,b.getAcceptTicketLink())};this.rejectTicket=function(g,e,f){if(c.getLoggedUser()){d({method:"POST",url:b.getRejectionTicketLink(),data:f,headers:{"x-crm-access-token":c.getLoggedUser().token.token}}).success(function(l,h,m,k){g()}).error(function(l,h,m,k){if(h==403){c.logout()}else{e()}})}};this.updateTicket=function(g,e,f){if(c.getLoggedUser()){d({method:"PUT",data:f,url:b.getUpdateTicketLink(),headers:{"x-crm-access-token":c.getLoggedUser().token.token}}).success(function(l,h,m,k){g()}).error(function(l,h,m,k){if(h==403){c.logout()}else{e()}})}};this.deleteTicket=function(f,e,g){if(c.getLoggedUser()){d({method:"DELETE",url:b.getDeleteTicketLink()+"/"+g,headers:{"x-crm-access-token":c.getLoggedUser().token.token}}).success(function(l,h,m,k){f()}).error(function(l,h,m,k){if(h==403){c.logout()}else{e()}})}};this.changeTicketStatus=function(g,e,h,f){if(c.getLoggedUser()){d({method:"GET",url:f+"/"+h,headers:{"x-crm-access-token":c.getLoggedUser().token.token}}).success(function(m,k,n,l){g(m)}).error(function(m,k,n,l){if(k==403){c.logout()}else{e()}})}};this.markAsbilled=function(g,e,f){if(c.getLoggedUser()){d({method:"GET",url:b.getMarkBilledLink()+"/"+f,headers:{"x-crm-access-token":c.getLoggedUser().token.token}}).success(function(l,h,m,k){g(l)}).error(function(l,h,m,k){if(h==403){c.logout()}else{e()}})}};this.markAsPayed=function(g,e,f){if(c.getLoggedUser()){d({method:"GET",url:b.getMarkPayedLink()+"/"+f,headers:{"x-crm-access-token":c.getLoggedUser().token.token}}).success(function(l,h,m,k){g(l)}).error(function(l,h,m,k){if(h==403){c.logout()}else{e()}})}};this.markManyAsBilled=function(g,f,e){if(c.getLoggedUser()){d({method:"POST",url:b.getMarkmanyBilledLink(),headers:{"x-crm-access-token":c.getLoggedUser().token.token},data:e}).success(function(l,h,m,k){g(l)}).error(function(l,h,m,k){if(h==403){c.logout()}else{f()}})}}}]);services.service("Task",["$http","Login","Links",function(c,b,a){this.craeteTask=function(f,d,e){this.execute(f,d,e,"POST",a.getCreatetaskLink())};this.updateTask=function(f,d,e){this.execute(f,d,e,"PUT",a.getUpdatetaskLink())};this.setEstimation=function(f,d,e){this.execute(f,d,e,"POST",a.getEstimationLink())};this.setRealtime=function(f,d,e){this.execute(f,d,e,"POST",a.getRealtimeLink())};this.addRealtime=function(f,d,e){this.execute(f,d,e,"POST",a.getAddRealtimeLink())};this.updateRealtime=function(f,d,e){this.execute(f,d,e,"PUT",a.getUpdateRealtimeLink())};this.deleteRealtime=function(f,d,g){if(b.getLoggedUser()){var e=this;c({method:"DELETE",url:a.getDeleteRealtimeLink()+"/"+g,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){f()}).error(function(l,h,m,k){if(h==403){b.logout()}else{d(l.error)}})}};this.getAllRealtimes=function(g,d,e){if(b.getLoggedUser()){var f=this;c({method:"GET",url:a.getAllRealtimesLink()+"/"+e,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){g(l)}).error(function(l,h,m,k){if(h==403){b.logout()}else{d(l.error)}})}};this.execute=function(h,d,g,k,f){if(b.getLoggedUser()){var e=this;c({method:k,url:f,data:g,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(n,l,o,m){h(n)}).error(function(n,l,o,m){if(l==403){b.logout()}else{d(n.error)}})}};this.getAllTasks=function(f,d,g){if(b.getLoggedUser()){var e=this;c({method:"GET",url:a.getListTasksLink()+"/"+g,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){f(l)}).error(function(l,h,m,k){if(h==403){b.logout()}else{d(l.error)}})}};this.startTask=function(g,d,e){if(b.getLoggedUser()){var f=this;c({method:"GET",url:a.getStartTaskLink()+"/"+e,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){g(l)}).error(function(l,h,m,k){if(h==403){b.logout()}else{d(l.error)}})}};this.deliverBugs=function(f,d,g){if(b.getLoggedUser()){var e=this;c({method:"GET",url:a.getDeliverBugToClientLink()+g,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){f(l)}).error(function(l,h,m,k){if(h==403){b.logout()}else{d(l.error)}})}};this.finishTask=function(g,d,e){if(b.getLoggedUser()){var f=this;c({method:"GET",url:a.getFinishTaskLink()+"/"+e,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){g(l)}).error(function(l,h,m,k){if(h==403){b.logout()}else{d(l.error)}})}};this.deleteTask=function(g,d,e){if(b.getLoggedUser()){var f=this;c({method:"DELETE",url:a.getDeleteTaskLink()+"/"+e,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){g(l)}).error(function(l,h,m,k){if(h==403){b.logout()}else{d(l.error)}})}};this.uploadTicketFile=function(g,d,f,h){if(b.getLoggedUser()){var e=this;c({method:"POST",url:a.getUplaodfileLink()+"/"+h,transformRequest:angular.identity,data:f,headers:{"x-crm-access-token":b.getLoggedUser().token.token,"Content-Type":undefined}}).success(function(m,k,n,l){g(m)}).error(function(m,k,n,l){if(k==403){b.logout()}else{d(m.error)}})}};this.deleteFile=function(g,d,f){if(b.getLoggedUser()){var e=this;c({method:"DELETE",url:a.getDeleteFileLink()+"/"+f,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(l,h,m,k){g()}).error(function(l,h,m,k){if(h==403){b.logout()}else{failureFunc(l.error)}})}};this.listFiles=function(f,d){if(b.getLoggedUser()){var e=this;c({method:"GET",url:a.getDocumentslistLink()+"/"+d,headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){f(k)}).error(function(k,g,l,h){if(g==403){b.logout()}})}};this.loadTaskTypes=function(d){if(b.getLoggedUser()){if(sessionStorage.tickettypes==null){c({method:"GET",url:a.getTaskTypesLink(),headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(g,e,h,f){sessionStorage.tickettypes=JSON.stringify(g);d(g)}).error(function(g,e,h,f){if(e==403){b.logout()}})}else{d(JSON.parse(sessionStorage.tickettypes))}}};this.acceptBug=function(f,d,e){if(b.getLoggedUser()){c({method:"POST",url:a.getAcceptBugLink(),data:e,headers:{"x-crm-access-token":b.getLoggedUser().token.token,"Content-Type":undefined}}).success(function(k,g,l,h){f(k)}).error(function(k,g,l,h){if(g==403){b.logout()}else{d(k.error)}})}}}]);services.service("Dashboard",["$http","Login","Links",function(c,b,a){this.loadAdminDashboard=function(f,d){if(b.getLoggedUser()){var e=this;c({method:"GET",url:a.getAdminDashboardLink(),headers:{"x-crm-access-token":b.getLoggedUser().token.token}}).success(function(k,g,l,h){f(k)}).error(function(k,g,l,h){if(g==403){b.logout()}else{d()}})}}}]);